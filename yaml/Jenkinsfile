// podTemplate(yaml: readTrusted('yaml/pod.yaml')) {
//   node(POD_LABEL) {   
//     stage('Run shell') {
//         sh "echo hello world"
//         sh "pwd && ls -l ./"
//         script {
//             build_tag = sh(returnStdout: true, script: 'git rev-parse --short HEAD').trim()
//             }
//           }
//     stage('Build Docker image') {
//       container('busybox') {
//         sh "echo hello from $POD_CONTAINER"
//         sh "pwd && ls -l ./"
//         echo "${build_tag}"
//       }
//     }
//   }
// }
// 声明式Pipeline
pipeline {
  agent {
    kubernetes {
      cloud 'kubernetes'
      slaveConnectTimeout 1200
      workspaceVolume hostPathWorkspaceVolume(hostPath: "/home/jenkins/agent", readOnly: false)   //持久化
      yamlFile 'yaml/pod.yaml'
    }
  }
  stages {
    stage('Run shell') {
      steps {
        sh "echo hello world"
        sh "pwd && ls -l ./"
        script {
            build_tag = sh(returnStdout: true, script: 'git rev-parse --short HEAD').trim()
            }
      }
    }
  }
}